<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¨‹å¼èªè¨€ç­†è¨˜æœ¬</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/latex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/css.min.js"></script>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --background-color: #f5f7fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --border-color: #e1e4e8;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
        }

        /* ä½¿ç”¨æŒ‡å—æŒ‰éˆ•æ¨£å¼ */
        .guide-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .guide-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .app-container {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }

        /* åˆ†é¡æ¬„ */
        .category-column {
            flex: 0 0 200px;
            min-width: 180px;
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            height: fit-content;
        }

        .category-list {
            margin-top: 12px;
            max-height: 420px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .category-item {
            padding: 8px 10px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
        }

        .category-item.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* åˆªé™¤æŒ‰éˆ•å°æ¨£å¼ */
        .category-item .del-btn {
            background: transparent;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 0.95rem;
            padding: 4px 6px;
            border-radius: 6px;
            transition: background 0.15s;
        }

        .category-item .del-btn:hover {
            background: rgba(0,0,0,0.06);
        }

        .category-actions {
            margin-top: 12px;
            display: flex;
            gap: 8px;
        }

        .sidebar {
            flex: 1;
            min-width: 280px;
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            height: fit-content;
        }

        .main-content {
            flex: 3;
            min-width: 300px;
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            color: var(--primary-color);
        }

        .note-list {
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }

        .note-item {
            padding: 15px;
            margin-bottom: 12px;
            background-color: var(--background-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid transparent;
        }

        .note-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-left-color: var(--secondary-color);
        }

        .note-item.active {
            background-color: var(--secondary-color);
            color: white;
            border-left-color: var(--primary-color);
        }

        .note-item .language-tag {
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 15px;
            background-color: rgba(255, 255, 255, 0.2);
            font-weight: bold;
        }

        .note-item .note-info {
            flex: 1;
        }

        .note-item .note-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .note-item .note-details {
            display: flex;
            gap: 10px;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .note-item .note-filename {
            color: var(--primary-color);
            font-family: 'Courier New', monospace;
        }

        .note-item .note-date {
            color: #666;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--primary-color);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(107, 140, 188, 0.2);
        }

        textarea {
            min-height: 300px;
            font-family: 'Courier New', Courier, monospace;
            resize: vertical;
            line-height: 1.5;
        }

        .btn {
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .code-preview {
            margin-top: 30px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .code-preview-header {
            background-color: #2c3e50;
            color: white;
            padding: 10px 15px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-preview pre {
            margin: 0;
            border-radius: 0;
            max-height: 400px;
            overflow: auto;
        }

        .review-result {
            margin-top: 20px;
            background: var(--card-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            display: none;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .review-header h3 {
            color: var(--primary-color);
            margin: 0;
        }

        .review-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            padding: 5px 15px;
            border-radius: 20px;
            background: var(--background-color);
        }

        .review-suggestions, .review-comments {
            margin-top: 10px;
        }

        .suggestion-item {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 6px;
            background: var(--background-color);
        }

        .suggestion-icon {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            border-radius: 50%;
            background: var(--secondary-color);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .empty-state p {
            margin-bottom: 20px;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 25px;
            color: #6c757d;
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
        }

        /* Login Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: var(--card-color);
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: none;
            font-size: 1.1rem;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0.7;
        }

        .tab-btn.active {
            opacity: 1;
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-text {
            color: #666;
            font-size: 0.85rem;
            margin-top: 5px;
            display: block;
        }

        .file-name-input {
            position: relative;
        }

        .file-ext-hint {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 0.9rem;
            pointer-events: none;
        }

        #fileName {
            padding-right: 60px;
        }

        #userInfo {
            margin-top: 15px;
        }

        #welcomeMessage {
            color: white;
            margin-right: 15px;
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar, .main-content {
                width: 100%;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }

            .modal-content {
                margin: 30% auto;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-tabs">
                <button class="tab-btn active" data-tab="login">ç™»å…¥</button>
                <button class="tab-btn" data-tab="register">è¨»å†Š</button>
            </div>
            
            <div id="loginTab" class="tab-content active">
                <h2>ç™»å…¥</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">ä½¿ç”¨è€…åç¨±</label>
                        <input type="text" id="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">å¯†ç¢¼</label>
                        <input type="password" id="password" required>
                    </div>
                    <button type="submit" class="btn">ç™»å…¥</button>
                </form>
            </div>

            <div id="registerTab" class="tab-content">
                <h2>è¨»å†Šæ–°å¸³è™Ÿ</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="newUsername">ä½¿ç”¨è€…åç¨±</label>
                        <input type="text" id="newUsername" required minlength="3" maxlength="20">
                        <small class="form-text">ä½¿ç”¨è€…åç¨±é•·åº¦éœ€è¦åœ¨3-20å€‹å­—å…ƒä¹‹é–“</small>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">å¯†ç¢¼</label>
                        <input type="password" id="newPassword" required minlength="6">
                        <small class="form-text">å¯†ç¢¼é•·åº¦è‡³å°‘éœ€è¦6å€‹å­—å…ƒ</small>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">ç¢ºèªå¯†ç¢¼</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                    <button type="submit" class="btn">è¨»å†Š</button>
                </form>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <button class="guide-btn" onclick="window.open('guide.html', '_blank')">
                <span>ğŸ“–</span> ä½¿ç”¨æŒ‡å—
            </button>
            <h1>ç¨‹å¼èªè¨€ç­†è¨˜æœ¬</h1>
            <p>è¨˜éŒ„ã€å­¸ç¿’å’Œæ•´ç†æ‚¨çš„ç¨‹å¼ç¢¼ç­†è¨˜ - æ”¯æ´å¤šç¨®ç¨‹å¼èªè¨€</p>
            <div id="userInfo" style="display: none;">
                <span id="welcomeMessage"></span>
                <button id="logoutBtn" class="btn btn-danger">ç™»å‡º</button>
            </div>
        </header>
        
        <div class="app-container">
            <div class="category-column">
                <h2 class="section-title">ç­†è¨˜åˆ†é¡</h2>
                <div id="categoryList" class="category-list">
                    <!-- åˆ†é¡é …ç›®å‹•æ…‹ç”Ÿæˆ -->
                </div>

                <div class="category-actions">
                    <input type="text" id="newCategoryInput" placeholder="æ–°å¢åˆ†é¡" style="flex:1; padding:8px; border:1px solid var(--border-color); border-radius:6px;">
                    <button id="addCategoryBtn" class="btn" style="padding:8px 12px;">æ–°å¢</button>
                </div>
            </div>
            <div class="sidebar">
                <h2 class="section-title">ç­†è¨˜åˆ—è¡¨</h2>
                <div class="note-list" id="noteList">
                    <!-- ç­†è¨˜åˆ—è¡¨å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    <div class="empty-state">
                        <h3>å°šç„¡ç­†è¨˜</h3>
                        <p>é»æ“Šä¸‹æ–¹ã€Œæ–°å¢ç­†è¨˜ã€é–‹å§‹è¨˜éŒ„</p>
                    </div>
                </div>
                <button class="btn btn-success" id="newNoteBtn" style="width: 100%; margin-top: 20px;">
                    <span>+</span> æ–°å¢ç­†è¨˜
                </button>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalNotes">0</div>
                        <div class="stat-label">ç¸½ç­†è¨˜æ•¸</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalLanguages">0</div>
                        <div class="stat-label">ä½¿ç”¨èªè¨€æ•¸</div>
                    </div>
                </div>
            </div>
            
            <div class="main-content">
                <h2 class="section-title">ç·¨è¼¯ç­†è¨˜</h2>
                <form id="noteForm">
                    <div class="form-group">
                        <label for="noteTitle">æ¨™é¡Œ</label>
                        <input type="text" id="noteTitle" placeholder="è¼¸å…¥ç­†è¨˜æ¨™é¡Œ">
                    </div>

                    <div class="form-group">
                        <label for="fileName">æª”æ¡ˆåç¨±</label>
                        <div class="file-name-input">
                            <input type="text" id="fileName" placeholder="è¼¸å…¥æª”æ¡ˆåç¨± (ä¾‹å¦‚: main.py)">
                            <small class="file-ext-hint"></small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="noteLanguage">ç¨‹å¼èªè¨€</label>
                        <select id="noteLanguage">
                            <option value="javascript">JavaScript</option>
                            <option value="python">Python</option>
                            <option value="java">Java</option>
                            <option value="c">C</option>
                            <option value="cpp">C++</option>
                            <option value="latex">LaTeX</option>
                            <option value="html">HTML</option>
                            <option value="css">CSS</option>
                            <option value="plaintext">ç´”æ–‡å­—</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="noteCategory">åˆ†é¡</label>
                        <select id="noteCategory">
                            <option value="__none">æœªåˆ†é¡</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="noteContent">ç¨‹å¼ç¢¼</label>
                        <textarea id="noteContent" placeholder="è¼¸å…¥æ‚¨çš„ç¨‹å¼ç¢¼..."></textarea>
                    </div>
                    
                    <div class="actions">
                        <div id="saveOptions" style="display:flex; gap:10px; flex:1;">
                            <button type="submit" class="btn" id="saveWithReviewBtn" style="flex:1;">
                                <span>ğŸ’¾</span> å„²å­˜ä¸¦æ‰¹æ”¹
                            </button>
                            <button type="submit" class="btn" id="saveWithoutReviewBtn" style="flex:1;">
                                <span>ğŸ’¾</span> ç›´æ¥å„²å­˜
                            </button>
                        </div>
                        <button type="button" class="btn btn-danger" id="deleteNoteBtn">
                            <span>ğŸ—‘ï¸</span> åˆªé™¤ç­†è¨˜
                        </button>
                    </div>
                </form>
                
                <div class="code-preview">
                    <div class="code-preview-header">
                        <span>ç¨‹å¼ç¢¼é è¦½</span>
                        <span id="previewLanguage">JavaScript</span>
                    </div>
                    <pre><code id="codePreview" class="language-javascript">// é è¦½å°‡é¡¯ç¤ºåœ¨é€™è£¡</code></pre>
                </div>

                <!-- æ‰¹æ”¹çµæœå€åŸŸ -->
                <div id="reviewResult" class="review-result">
                    <div class="review-header">
                        <h3>ç¨‹å¼ç¢¼æ‰¹æ”¹çµæœ</h3>
                        <div class="review-score"></div>
                    </div>
                    <div class="review-content">
                        <div class="review-suggestions"></div>
                        <div class="review-comments"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>ç¨‹å¼èªè¨€ç­†è¨˜æœ¬ &copy; 2023 - å°ˆç‚ºå­¸ç¿’ç¨‹å¼è¨­è¨ˆè€Œè¨­è¨ˆ | æ”¯æ´ JavaScript, Python, Java, C, C++, LaTeX, HTML, CSS</p>
        </footer>
    </div>

    <script>
        // åˆå§‹åŒ– highlight.js
        hljs.highlightAll();

        // ç™»å…¥ç›¸é—œ
        const loginModal = document.getElementById('loginModal');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const userInfo = document.getElementById('userInfo');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const logoutBtn = document.getElementById('logoutBtn');
        
        // æ¨¡æ“¬ç”¨æˆ¶æ•¸æ“šï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­æ‡‰è©²ä½¿ç”¨å¾Œç«¯é©—è­‰ï¼‰
        let users = JSON.parse(localStorage.getItem('users')) || [
            { username: 'admin', password: 'admin123' },
            { username: 'user', password: 'user123' }
        ];

        // æ¨™ç±¤åˆ‡æ›åŠŸèƒ½
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æ´»å‹•ç‹€æ…‹
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // æ·»åŠ æ–°çš„æ´»å‹•ç‹€æ…‹
                button.classList.add('active');
                document.getElementById(button.dataset.tab + 'Tab').classList.add('active');
            });
        });

        // è¨»å†Šè¡¨å–®è™•ç†
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newUsername = document.getElementById('newUsername').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // é©—è­‰ä½¿ç”¨è€…åç¨±é•·åº¦
            if (newUsername.length < 3 || newUsername.length > 20) {
                showMessage('ä½¿ç”¨è€…åç¨±é•·åº¦éœ€è¦åœ¨3-20å€‹å­—å…ƒä¹‹é–“', 'error');
                return;
            }

            // é©—è­‰å¯†ç¢¼é•·åº¦
            if (newPassword.length < 6) {
                showMessage('å¯†ç¢¼é•·åº¦è‡³å°‘éœ€è¦6å€‹å­—å…ƒ', 'error');
                return;
            }

            // é©—è­‰å¯†ç¢¼åŒ¹é…
            if (newPassword !== confirmPassword) {
                showMessage('å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´', 'error');
                return;
            }

            // æª¢æŸ¥ä½¿ç”¨è€…åç¨±æ˜¯å¦å·²å­˜åœ¨
            if (users.some(user => user.username === newUsername)) {
                showMessage('æ­¤ä½¿ç”¨è€…åç¨±å·²è¢«ä½¿ç”¨', 'error');
                return;
            }

            // å‰µå»ºæ–°ç”¨æˆ¶
            users.push({ username: newUsername, password: newPassword });
            localStorage.setItem('users', JSON.stringify(users));
            
            // è‡ªå‹•ç™»å…¥æ–°ç”¨æˆ¶
            localStorage.setItem('currentUser', newUsername);
            
            // æ¸…é™¤è¡¨å–®
            registerForm.reset();
            
            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯ä¸¦æ›´æ–°ç‹€æ…‹
            showMessage('è¨»å†ŠæˆåŠŸï¼æ­¡è¿åŠ å…¥', 'success');
            checkLoginStatus();
        });

        // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        function checkLoginStatus() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                loginModal.style.display = 'block';
                userInfo.style.display = 'none';
                document.querySelector('.app-container').style.display = 'none';
            } else {
                loginModal.style.display = 'none';
                userInfo.style.display = 'block';
                welcomeMessage.textContent = `æ­¡è¿, ${currentUser}!`;
                document.querySelector('.app-container').style.display = 'flex';
            }
        }

        // ç™»å…¥è¡¨å–®æäº¤
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                localStorage.setItem('currentUser', username);
                checkLoginStatus();
                showMessage('ç™»å…¥æˆåŠŸï¼', 'success');
            } else {
                showMessage('ä½¿ç”¨è€…åç¨±æˆ–å¯†ç¢¼éŒ¯èª¤', 'error');
            }
        });

        // ç™»å‡º
        logoutBtn.addEventListener('click', () => {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                localStorage.removeItem('currentUser');
                checkLoginStatus();
                showMessage('å·²ç™»å‡º', 'success');
            }
        });

        // åˆå§‹æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        checkLoginStatus();

        // æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹
        let notes = JSON.parse(localStorage.getItem('codeNotes')) || [];
        let currentNoteId = null;
    // åˆ†é¡ç®¡ç†
    let categories = JSON.parse(localStorage.getItem('noteCategories')) || [];
    let currentCategory = 'all'; // 'all' è¡¨ç¤ºä¸ç¯©é¸ï¼›å¦å‰‡ç‚º category åç¨±

        // DOM å…ƒç´ 
        const noteList = document.getElementById('noteList');
        const categoryList = document.getElementById('categoryList');
        const newCategoryInput = document.getElementById('newCategoryInput');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const reviewResult = document.getElementById('reviewResult');
        const noteForm = document.getElementById('noteForm');
        const noteTitle = document.getElementById('noteTitle');
        const noteLanguage = document.getElementById('noteLanguage');
    const noteCategorySelect = document.getElementById('noteCategory');
        const noteContent = document.getElementById('noteContent');
        const codePreview = document.getElementById('codePreview');
        const previewLanguage = document.getElementById('previewLanguage');
        const newNoteBtn = document.getElementById('newNoteBtn');
        const saveNoteBtn = document.getElementById('saveNoteBtn');
        const deleteNoteBtn = document.getElementById('deleteNoteBtn');
        const totalNotes = document.getElementById('totalNotes');
        const totalLanguages = document.getElementById('totalLanguages');

        // äº‹ä»¶ç›£è½å™¨
        const saveWithReviewBtn = document.getElementById('saveWithReviewBtn');
        const saveWithoutReviewBtn = document.getElementById('saveWithoutReviewBtn');
        
        // ç§»é™¤è¡¨å–®çš„ submit äº‹ä»¶ï¼Œæ”¹ç”¨æŒ‰éˆ•
        noteForm.addEventListener('submit', (e) => e.preventDefault());
        saveWithReviewBtn.addEventListener('click', () => saveNote(true));
        saveWithoutReviewBtn.addEventListener('click', () => saveNote(false));
        newNoteBtn.addEventListener('click', createNewNote);
        deleteNoteBtn.addEventListener('click', deleteCurrentNote);
        addCategoryBtn.addEventListener('click', addCategory);
        newCategoryInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') addCategory(); });
        noteLanguage.addEventListener('change', () => {
            updatePreview();
            updateFileNameHint();
        });
        noteContent.addEventListener('input', updatePreview);

        // åˆå§‹åŒ–æª”æ¡ˆåç¨±æç¤º
        updateFileNameHint();

        // åˆå§‹åŒ–æ‡‰ç”¨
        renderNoteList();
        renderCategories();
        updateNoteCategorySelect();
        updatePreview();
        updateStats();

        // å¦‚æœæ²’æœ‰åˆ†é¡ï¼Œå»ºç«‹é è¨­çš„å¹¾å€‹åˆ†é¡
        if (categories.length === 0) {
            categories = ['ç¯„ä¾‹', 'ç·´ç¿’', 'åƒè€ƒ'];
            localStorage.setItem('noteCategories', JSON.stringify(categories));
            renderCategories();
            updateNoteCategorySelect();
        }

        // å‡½æ•¸å®šç¾©
        function renderNoteList() {
            const visibleNotes = currentCategory === 'all' ? notes : notes.filter(n => (n.category || '__none') === currentCategory);

            if (visibleNotes.length === 0) {
                noteList.innerHTML = `
                    <div class="empty-state">
                        <h3>å°šç„¡ç­†è¨˜</h3>
                        <p>é»æ“Šä¸‹æ–¹ã€Œæ–°å¢ç­†è¨˜ã€é–‹å§‹è¨˜éŒ„</p>
                    </div>
                `;
                return;
            }

            // æŒ‰æ›´æ–°æ™‚é–“æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            visibleNotes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            
            noteList.innerHTML = visibleNotes.map(note => `
                <div class="note-item ${note.id === currentNoteId ? 'active' : ''}" data-id="${note.id}">
                    <div class="note-info">
                        <div class="note-title">${note.title}</div>
                        <div class="note-details">
                            <span class="note-filename">${note.fileName || 'æœªå‘½å'}</span>
                            <span class="note-date">${new Date(note.updatedAt).toLocaleDateString()} ${new Date(note.updatedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                            <span class="note-category">${note.category ? note.category : 'æœªåˆ†é¡'}</span>
                        </div>
                    </div>
                    <span class="language-tag">${getLanguageName(note.language)}</span>
                </div>
            `).join('');

            // ç‚ºæ¯å€‹ç­†è¨˜é …ç›®æ·»åŠ é»æ“Šäº‹ä»¶
            document.querySelectorAll('.note-item').forEach(item => {
                item.addEventListener('click', () => {
                    const noteId = item.getAttribute('data-id');
                    loadNote(noteId);
                });
            });
        }

        function getLanguageName(langCode) {
            const languages = {
                'javascript': 'JS',
                'python': 'Python',
                'java': 'Java',
                'c': 'C',
                'cpp': 'C++',
                'latex': 'LaTeX',
                'html': 'HTML',
                'css': 'CSS',
                'plaintext': 'Text'
            };
            return languages[langCode] || langCode;
        }

        function getFullLanguageName(langCode) {
            const languages = {
                'javascript': 'JavaScript',
                'python': 'Python',
                'java': 'Java',
                'c': 'C',
                'cpp': 'C++',
                'latex': 'LaTeX',
                'html': 'HTML',
                'css': 'CSS',
                'plaintext': 'ç´”æ–‡å­—'
            };
            return languages[langCode] || langCode;
        }

        // æ ¹æ“šç¨‹å¼èªè¨€å–å¾—å»ºè­°çš„å‰¯æª”å
        function getDefaultExtension(language) {
            const extensions = {
                'javascript': '.js',
                'python': '.py',
                'java': '.java',
                'c': '.c',
                'cpp': '.cpp',
                'latex': '.tex',
                'html': '.html',
                'css': '.css',
                'plaintext': '.txt'
            };
            return extensions[language] || '';
        }

        // æ›´æ–°æª”æ¡ˆåç¨±æç¤º
        function updateFileNameHint() {
            const language = noteLanguage.value;
            const defaultExt = getDefaultExtension(language);
            const hintEl = document.querySelector('.file-ext-hint');
            hintEl.textContent = `å»ºè­°å‰¯æª”å: ${defaultExt}`;
        }

        function createNewNote() {
            currentNoteId = null;
            noteTitle.value = '';
            document.getElementById('fileName').value = '';
            noteLanguage.value = 'javascript';
            noteContent.value = '';
            // é è¨­åˆ†é¡ç‚ºç•¶å‰é¸æ“‡çš„åˆ†é¡ï¼ˆè‹¥ç‚º all å‰‡æœªåˆ†é¡ï¼‰
            noteCategorySelect.value = currentCategory === 'all' ? '__none' : currentCategory;
            // éš±è—æ‰¹æ”¹çµæœ
            reviewResult.style.display = 'none';
            updatePreview();
            updateFileNameHint();
            renderNoteList();
        }

        function loadNote(noteId) {
            const note = notes.find(n => n.id === noteId);
            if (note) {
                currentNoteId = noteId;
                noteTitle.value = note.title;
                document.getElementById('fileName').value = note.fileName || '';
                noteLanguage.value = note.language;
                noteContent.value = note.content;
                // è¨­å®šåˆ†é¡
                noteCategorySelect.value = note.category || '__none';
                updatePreview();
                updateFileNameHint();
                renderNoteList();
            }
        }

        function saveNote(withReview) {
            const title = noteTitle.value.trim();
            const fileName = document.getElementById('fileName').value.trim();
            const language = noteLanguage.value;
            const category = noteCategorySelect.value === '__none' ? null : noteCategorySelect.value;
            const content = noteContent.value;
            
            if (!title) {
                alert('è«‹è¼¸å…¥ç­†è¨˜æ¨™é¡Œ');
                return;
            }
            
            const now = new Date().toISOString();
            
            if (currentNoteId) {
                // æ›´æ–°ç¾æœ‰ç­†è¨˜
                const noteIndex = notes.findIndex(n => n.id === currentNoteId);
                if (noteIndex !== -1) {
                    notes[noteIndex] = {
                        ...notes[noteIndex],
                        title,
                        fileName,
                        language,
                        category,
                        content,
                        updatedAt: now
                    };
                }
            } else {
                // å»ºç«‹æ–°ç­†è¨˜
                const newNote = {
                    id: generateId(),
                    title,
                    fileName,
                    language,
                    category,
                    content,
                    createdAt: now,
                    updatedAt: now
                };
                notes.push(newNote);
                currentNoteId = newNote.id;
            }
            
            // å„²å­˜åˆ°æœ¬åœ°å„²å­˜
            localStorage.setItem('codeNotes', JSON.stringify(notes));
            
            // æ›´æ–°ä»‹é¢
            renderNoteList();
            renderCategories();
            updateNoteCategorySelect();
            updateStats();
            
            // å¦‚æœéœ€è¦æ‰¹æ”¹ï¼ŒåŸ·è¡Œæ‰¹æ”¹ä¸¦é¡¯ç¤ºçµæœ
            if (withReview) {
                const review = reviewCode(content, language);
                showReviewResult(review);
            } else {
                // éš±è—æ‰¹æ”¹çµæœ
                reviewResult.style.display = 'none';
            }

            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            showMessage(withReview ? 'ç­†è¨˜å·²å„²å­˜ä¸¦å®Œæˆæ‰¹æ”¹ï¼' : 'ç­†è¨˜å·²å„²å­˜ï¼', 'success');
        }

        /* ç¨‹å¼ç¢¼æ‰¹æ”¹ç›¸é—œåŠŸèƒ½ */
        function reviewCode(code, language) {
            const review = {
                score: 0,
                suggestions: [],
                comments: []
            };

            // æª¢æŸ¥é …ç›®èˆ‡åˆ†æ•¸æ¬Šé‡
            const codeLines = code.split('\n').length;
            const isLongCode = codeLines > 50;
            
            // æ ¹æ“šç¨‹å¼ç¢¼é•·åº¦èª¿æ•´æ¬Šé‡
            const weights = {
                base: 40,          // åŸºç¤åˆ†æ•¸
                structure: {       // çµæ§‹æ€§è©•åˆ†ï¼ˆ25åˆ†ï¼‰
                    indentation: isLongCode ? 10 : 5,    // ç¸®æ’
                    emptyLines: isLongCode ? 10 : 5,     // ç©ºè¡Œä½¿ç”¨
                    length: 5                            // é©ç•¶çš„é•·åº¦
                },
                documentation: {   // æ–‡ä»¶æ€§è©•åˆ†ï¼ˆ15åˆ†ï¼‰
                    comments: isLongCode ? 10 : 8,       // è¨»è§£æ•¸é‡èˆ‡å“è³ª
                    docStyle: 5                          // è¨»è§£é¢¨æ ¼ï¼ˆå€å¡Š/è¡Œå…§ï¼‰
                },
                naming: {         // å‘½åè¦ç¯„ï¼ˆ10åˆ†ï¼‰
                    variables: 5,                        // è®Šæ•¸å‘½å
                    functions: 5                         // å‡½å¼å‘½å
                },
                complexity: {     // è¤‡é›œåº¦è©•åˆ†ï¼ˆ10åˆ†ï¼‰
                    nesting: 5,                          // å·¢ç‹€æ·±åº¦
                    lineLength: 5                        // å–®è¡Œé•·åº¦
                }
            };

            // åŸºæœ¬æª¢æŸ¥
            let score = weights.base;
            const lines = code.split('\n');
            
            // 1. çµæ§‹æ€§è©•åˆ†
            // ç¸®æ’æª¢æŸ¥ï¼šè¨ˆç®—æœ‰æ•ˆç¸®æ’çš„è¡Œæ•¸æ¯”ä¾‹
            const indentedLines = lines.filter(line => /^\s+\S/.test(line)).length;
            const shouldBeIndented = lines.filter(line => /^(if|for|while|function|class|else|switch|try|catch)/.test(line.trim())).length;
            if (shouldBeIndented > 0 && indentedLines / shouldBeIndented >= 0.8) {
                score += weights.structure.indentation;
            } else {
                review.suggestions.push({
                    icon: 'â‡¥',
                    text: 'ç¨‹å¼ç¢¼ç¸®æ’éœ€è¦æ”¹å–„ï¼Œå»ºè­°åœ¨ç¨‹å¼å€å¡Šå…§ä½¿ç”¨ä¸€è‡´çš„ç¸®æ’'
                });
            }

            // ç©ºè¡Œä½¿ç”¨
            const emptyLineRatio = lines.filter(line => /^\s*$/.test(line)).length / lines.length;
            if (emptyLineRatio >= 0.1 && emptyLineRatio <= 0.3) {
                score += weights.structure.emptyLines;
            } else {
                review.suggestions.push({
                    icon: 'â†•ï¸',
                    text: 'å»ºè­°åœ¨é©ç•¶ä½ç½®åŠ å…¥ç©ºè¡Œï¼Œä»¥æé«˜ç¨‹å¼ç¢¼å¯è®€æ€§'
                });
            }

            // ç¨‹å¼ç¢¼é•·åº¦
            if (codeLines <= 100) {
                score += weights.structure.length;
            } else {
                review.suggestions.push({
                    icon: 'ğŸ“',
                    text: 'ç¨‹å¼ç¢¼éé•·ï¼Œå»ºè­°æ‹†åˆ†ç‚ºå¤šå€‹è¼ƒå°çš„å‡½å¼'
                });
            }

            // 2. æ–‡ä»¶æ€§è©•åˆ†
            // è¨»è§£æ•¸é‡èˆ‡ä½ç½®
            const commentLines = lines.filter(line => /^\s*(\/\/|\/\*|\*)/.test(line)).length;
            const commentRatio = commentLines / codeLines;
            if (commentRatio >= 0.1) {
                score += weights.documentation.comments;
            } else {
                review.suggestions.push({
                    icon: 'ğŸ’­',
                    text: 'è¨»è§£æ•¸é‡åå°‘ï¼Œå»ºè­°ç‚ºé‡è¦çš„ç¨‹å¼ç¢¼å€å¡ŠåŠ å…¥èªªæ˜'
                });
            }

            // è¨»è§£é¢¨æ ¼
            const hasBlockComments = /\/\*[\s\S]*?\*\//.test(code);
            const hasInlineComments = /\/\/[^\n]*/.test(code);
            if (hasBlockComments && hasInlineComments) {
                score += weights.documentation.docStyle;
            } else {
                review.suggestions.push({
                    icon: 'ğŸ“',
                    text: 'å»ºè­°æ··åˆä½¿ç”¨å€å¡Šè¨»è§£ï¼ˆèªªæ˜æ•´é«”ï¼‰å’Œè¡Œå…§è¨»è§£ï¼ˆèªªæ˜ç´°ç¯€ï¼‰'
                });
            }

            // 3. å‘½åè¦ç¯„
            const naming = checkNamingConventions(code, language);
            if (naming.variableScore >= 0.8) {
                score += weights.naming.variables;
            } else {
                review.suggestions.push({
                    icon: 'ï¿½',
                    text: 'è®Šæ•¸å‘½åå¯ä»¥æ›´å…·æè¿°æ€§ï¼Œéµå¾ªèªè¨€æ…£ä¾‹'
                });
            }
            if (naming.functionScore >= 0.8) {
                score += weights.naming.functions;
            } else {
                review.suggestions.push({
                    icon: 'ğŸ”§',
                    text: 'å‡½å¼åç¨±æ‡‰è©²æ¸…æ¥šè¡¨é”å…¶åŠŸèƒ½'
                });
            }

            // 4. è¤‡é›œåº¦è©•åˆ†
            // å·¢ç‹€æ·±åº¦æª¢æŸ¥
            const maxNestingDepth = Math.max(...lines.map(line => 
                (line.match(/^\s+/)||[''])[0].length / 2));
            if (maxNestingDepth <= 4) {
                score += weights.complexity.nesting;
            } else {
                review.suggestions.push({
                    icon: 'ï¿½',
                    text: 'ç¨‹å¼ç¢¼å·¢ç‹€å±¤ç´šéæ·±ï¼Œå»ºè­°é‡æ§‹ä»¥é™ä½è¤‡é›œåº¦'
                });
            }

            // å–®è¡Œé•·åº¦æª¢æŸ¥
            const longLines = lines.filter(line => line.length > 80).length;
            if (longLines / lines.length < 0.1) {
                score += weights.complexity.lineLength;
            } else {
                review.suggestions.push({
                    icon: 'ğŸ“Š',
                    text: 'æœ‰äº›ç¨‹å¼ç¢¼è¡Œå¤ªé•·ï¼Œå»ºè­°åˆ†å‰²ç‚ºå¤šè¡Œä»¥æé«˜å¯è®€æ€§'
                });
            }

            // èªè¨€ç‰¹å®šæª¢æŸ¥
            const languageSpecificScore = checkLanguageSpecific(code, language);
            score += languageSpecificScore;

            // æœ€çµ‚è©•èª
            if (score >= 90) {
                review.comments.push('ç¨‹å¼ç¢¼å“è³ªå„ªç•°ï¼æ¶æ§‹æ¸…æ™°ï¼Œæ˜“æ–¼ç¶­è­·ã€‚');
            } else if (score >= 80) {
                review.comments.push('ç¨‹å¼ç¢¼æ•´é«”ä¸éŒ¯ï¼Œæœ‰ä¸€äº›å°åœ°æ–¹å¯ä»¥æ”¹é€²ã€‚');
            } else if (score >= 70) {
                review.comments.push('ç¨‹å¼ç¢¼åŸºæœ¬å¯ç”¨ï¼Œä½†å»ºè­°åƒè€ƒå»ºè­°é€²è¡Œæ”¹é€²ã€‚');
            } else {
                review.comments.push('ç¨‹å¼ç¢¼éœ€è¦æ”¹é€²ï¼Œè«‹åƒè€ƒä¸Šè¿°å»ºè­°é€²è¡Œä¿®æ”¹ã€‚');
            }

            review.score = Math.min(100, Math.max(0, score));
            return review;
        }

        function checkNamingConventions(code, language) {
            // æ ¹æ“šä¸åŒèªè¨€çš„å‘½åè¦å‰‡
            const conventions = {
                javascript: {
                    variable: /^[a-z][a-zA-Z0-9]*$/,
                    function: /^[a-z][a-zA-Z0-9]*$/,
                    class: /^[A-Z][a-zA-Z0-9]*$/
                },
                python: {
                    variable: /^[a-z_][a-z0-9_]*$/,
                    function: /^[a-z_][a-z0-9_]*$/,
                    class: /^[A-Z][a-zA-Z0-9]*$/
                },
                java: {
                    variable: /^[a-z][a-zA-Z0-9]*$/,
                    function: /^[a-z][a-zA-Z0-9]*$/,
                    class: /^[A-Z][a-zA-Z0-9]*$/
                }
            };

            const defaultConvention = {
                variable: /^[a-zA-Z][a-zA-Z0-9]*$/,
                function: /^[a-zA-Z][a-zA-Z0-9]*$/,
                class: /^[A-Z][a-zA-Z0-9]*$/
            };

            const convention = conventions[language] || defaultConvention;

            // æª¢æŸ¥è®Šæ•¸å‘½å
            const vars = code.match(/\b(?:let|var|const|int|float|string|def)\s+([a-zA-Z_][a-zA-Z0-9_]*)\b/g) || [];
            const validVars = vars.filter(v => convention.variable.test(v.split(/\s+/)[1])).length;
            const variableScore = vars.length > 0 ? validVars / vars.length : 1;

            // æª¢æŸ¥å‡½å¼å‘½å
            const funcs = code.match(/\b(?:function|def)\s+([a-zA-Z_][a-zA-Z0-9_]*)\b/g) || [];
            const validFuncs = funcs.filter(f => convention.function.test(f.split(/\s+/)[1])).length;
            const functionScore = funcs.length > 0 ? validFuncs / funcs.length : 1;

            return {
                variableScore,
                functionScore
            };
        }

        function checkLanguageSpecific(code, language) {
            let score = 0;
            
            switch (language) {
                case 'javascript':
                    if (!/console\.log/.test(code)) score += 2;
                    if (/const/.test(code)) score += 2;
                    if (/===/.test(code)) score += 2;
                    break;
                case 'python':
                    if (/def\s+\w+/.test(code)) score += 2;
                    if (/if\s+__name__\s*==\s*('|")__main__\1/.test(code)) score += 2;
                    if (!/print\(/.test(code)) score += 2;
                    break;
                case 'java':
                    if (/class\s+\w+/.test(code)) score += 2;
                    if (/public\s+static\s+void\s+main/.test(code)) score += 2;
                    if (/private/.test(code)) score += 2;
                    break;
            }
            
            return score;
        }

        function showReviewResult(review) {
            const scoreEl = reviewResult.querySelector('.review-score');
            const suggestionsEl = reviewResult.querySelector('.review-suggestions');
            const commentsEl = reviewResult.querySelector('.review-comments');

            // é¡¯ç¤ºåˆ†æ•¸
            scoreEl.textContent = `${review.score} åˆ†`;
            scoreEl.style.color = getScoreColor(review.score);

            // é¡¯ç¤ºå»ºè­°
            suggestionsEl.innerHTML = review.suggestions.map(suggestion => `
                <div class="suggestion-item">
                    <span class="suggestion-icon">${suggestion.icon}</span>
                    <span>${suggestion.text}</span>
                </div>
            `).join('');

            // é¡¯ç¤ºè©•èª
            commentsEl.innerHTML = review.comments.map(comment => `
                <div class="suggestion-item">
                    <span class="suggestion-icon">ğŸ“‹</span>
                    <span>${comment}</span>
                </div>
            `).join('');

            // é¡¯ç¤ºçµæœå€åŸŸ
            reviewResult.style.display = 'block';
        }

        function getScoreColor(score) {
            if (score >= 90) return '#4cd137';
            if (score >= 80) return '#7bed9f';
            if (score >= 70) return '#ffb142';
            return '#ff6b6b';
        }

        /* åˆ†é¡ç›¸é—œåŠŸèƒ½ */
        function renderCategories() {
            // 'å…¨éƒ¨' ç‚ºç‰¹æ®Šé …ç›®ï¼Œé¡¯ç¤ºç¸½æ•¸
            const allBtn = document.createElement('div');
            allBtn.className = `category-item ${currentCategory === 'all' ? 'active' : ''}`;
            const allCount = notes.length;
            allBtn.innerHTML = `<span>å…¨éƒ¨</span><span style="opacity:0.8">${allCount}</span>`;
            allBtn.addEventListener('click', () => selectCategory('all'));

            categoryList.innerHTML = '';
            categoryList.appendChild(allBtn);

            categories.forEach(cat => {
                const count = notes.filter(n => (n.category || '__none') === cat).length;
                const el = document.createElement('div');
                el.className = `category-item ${currentCategory === cat ? 'active' : ''}`;

                // å»ºç«‹åç¨±èˆ‡æ•¸å­—å€å¡Šï¼ˆå·¦ name / ä¸­ countï¼‰
                const nameSpan = document.createElement('span');
                nameSpan.textContent = cat;
                const countSpan = document.createElement('span');
                countSpan.style.opacity = '0.8';
                countSpan.textContent = count;

                // åˆªé™¤æŒ‰éˆ•ï¼ˆå°å‹ï¼‰ï¼Œé»æ“Šæ™‚é˜»æ­¢å‘ä¸Šå†’æ³¡
                const delBtn = document.createElement('button');
                delBtn.className = 'del-btn';
                delBtn.type = 'button';
                delBtn.title = 'åˆªé™¤åˆ†é¡';
                delBtn.textContent = 'ğŸ—‘ï¸';
                delBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteCategory(cat);
                });

                el.appendChild(nameSpan);
                el.appendChild(countSpan);
                el.appendChild(delBtn);

                el.addEventListener('click', () => selectCategory(cat));
                categoryList.appendChild(el);
            });
        }

        function addCategory() {
            const name = newCategoryInput.value.trim();
            if (!name) return;
            if (categories.includes(name)) {
                showMessage('æ­¤åˆ†é¡å·²å­˜åœ¨', 'error');
                return;
            }
            categories.push(name);
            localStorage.setItem('noteCategories', JSON.stringify(categories));
            newCategoryInput.value = '';
            renderCategories();
            updateNoteCategorySelect();
            showMessage('å·²æ–°å¢åˆ†é¡', 'success');
        }

        // åˆªé™¤åˆ†é¡ï¼šæœƒå°‡è©²åˆ†é¡ä¸‹çš„ç­†è¨˜ç§»åˆ°æœªåˆ†é¡
        function deleteCategory(cat) {
            const count = notes.filter(n => (n.category || '__none') === cat).length;
            const ok = confirm(`ç¢ºå®šåˆªé™¤åˆ†é¡ "${cat}"ï¼Ÿ\næ­¤åˆ†é¡ä¸‹æœ‰ ${count} ç­†ç­†è¨˜ï¼Œåˆªé™¤å¾Œé€™äº›ç­†è¨˜æœƒè¢«ç§»è‡³ã€Œæœªåˆ†é¡ã€ã€‚`);
            if (!ok) return;

            // æŠŠè©²åˆ†é¡çš„ç­†è¨˜è¨­ç‚º nullï¼ˆæœªåˆ†é¡ï¼‰
            notes = notes.map(n => {
                if ((n.category || '__none') === cat) {
                    return { ...n, category: null };
                }
                return n;
            });

            // å¾ categories é™£åˆ—ç§»é™¤
            categories = categories.filter(c => c !== cat);

            // æ›´æ–°æœ¬åœ°å„²å­˜
            localStorage.setItem('codeNotes', JSON.stringify(notes));
            localStorage.setItem('noteCategories', JSON.stringify(categories));

            // é‡æ–°æ¸²æŸ“
            renderCategories();
            renderNoteList();
            updateNoteCategorySelect();
            updateStats();

            showMessage('å·²åˆªé™¤åˆ†é¡ï¼Œä¸¦å°‡ç›¸é—œç­†è¨˜ç§»è‡³æœªåˆ†é¡', 'success');
        }

        function selectCategory(cat) {
            currentCategory = cat;
            renderCategories();
            renderNoteList();
        }

        function updateNoteCategorySelect() {
            // æ¸…ç©ºé¸å–®ä¸¦é‡å»º
            const existing = Array.from(noteCategorySelect.options).map(o => o.value);
            noteCategorySelect.innerHTML = '';
            const noneOpt = document.createElement('option');
            noneOpt.value = '__none';
            noneOpt.textContent = 'æœªåˆ†é¡';
            noteCategorySelect.appendChild(noneOpt);

            categories.forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                noteCategorySelect.appendChild(opt);
            });
        }

        function deleteCurrentNote() {
            if (!currentNoteId) {
                showMessage('æ²’æœ‰é¸æ“‡è¦åˆªé™¤çš„ç­†è¨˜', 'error');
                return;
            }
            
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç­†è¨˜å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                notes = notes.filter(note => note.id !== currentNoteId);
                localStorage.setItem('codeNotes', JSON.stringify(notes));
                createNewNote();
                renderNoteList();
                renderCategories();
                updateNoteCategorySelect();
                updateStats();
                showMessage('ç­†è¨˜å·²åˆªé™¤', 'success');
            }
        }

        function updatePreview() {
            const language = noteLanguage.value;
            const content = noteContent.value || '// é è¦½å°‡é¡¯ç¤ºåœ¨é€™è£¡';
            
            codePreview.textContent = content;
            codePreview.className = `language-${language}`;
            previewLanguage.textContent = getFullLanguageName(language);
            hljs.highlightElement(codePreview);
        }

        function updateStats() {
            totalNotes.textContent = notes.length;
            
            // è¨ˆç®—ä½¿ç”¨çš„èªè¨€æ•¸é‡
            const languages = new Set(notes.map(note => note.language));
            totalLanguages.textContent = languages.size;
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function showMessage(message, type) {
            // å»ºç«‹è¨Šæ¯å…ƒç´ 
            const messageEl = document.createElement('div');
            messageEl.textContent = message;
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                transition: transform 0.3s, opacity 0.3s;
                transform: translateX(100%);
                opacity: 0;
            `;
            
            if (type === 'success') {
                messageEl.style.backgroundColor = 'var(--success-color)';
            } else {
                messageEl.style.backgroundColor = 'var(--danger-color)';
            }
            
            document.body.appendChild(messageEl);
            
            // é¡¯ç¤ºè¨Šæ¯
            setTimeout(() => {
                messageEl.style.transform = 'translateX(0)';
                messageEl.style.opacity = '1';
            }, 10);
            
            // éš±è—è¨Šæ¯
            setTimeout(() => {
                messageEl.style.transform = 'translateX(100%)';
                messageEl.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(messageEl);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>